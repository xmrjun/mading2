# 马丁格尔交易策略使用指南

## 📋 策略说明

马丁格尔策略是一种经典的交易策略，核心原理是：
- **亏损时加倍下注**：每次亏损后，下次投注金额翻倍
- **盈利时重置**：一旦盈利，回到基础投注金额
- **止损保护**：设置最大连续亏损次数，避免无限亏损

## 🚀 快速开始

### 1. 配置API密钥
编辑 `martingale_config.json` 文件：
```json
{
  "api": {
    "privateKey": "YOUR_BACKPACK_PRIVATE_KEY",
    "publicKey": "YOUR_BACKPACK_PUBLIC_KEY"
  }
}
```

### 2. 调整策略参数
```json
{
  "trading": {
    "tradingCoin": "ETH",           // 交易币种
    "baseAmount": 50,               // 基础投注金额 (USDC)
    "martingaleMultiplier": 2,      // 加倍系数
    "maxConsecutiveLosses": 5,      // 最大连续亏损次数
    "takeProfitPercentage": 1.0,    // 止盈百分比
    "stopLossPercentage": 10.0      // 止损百分比
  }
}
```

### 3. 启动策略
```bash
# 安装依赖
npm install

# 启动马丁格尔交易器
node martingale_trader.js
```

## ⚙️ 核心参数说明

### 基础参数
| 参数 | 说明 | 建议值 | 风险等级 |
|------|------|--------|----------|
| `baseAmount` | 基础投注金额 | 50-100 USDC | 低 |
| `martingaleMultiplier` | 亏损时的倍数 | 2.0 | 中 |
| `maxConsecutiveLosses` | 最大连续亏损 | 5次 | 高 |

### 风险控制
| 参数 | 说明 | 建议值 |
|------|------|--------|
| `takeProfitPercentage` | 止盈百分比 | 1.0% |
| `stopLossPercentage` | 止损百分比 | 10.0% |
| `maxTotalInvestment` | 最大总投资 | 1000 USDC |

## 📊 策略示例

### 示例场景：基础金额50 USDC，倍数2.0

| 交易次数 | 投注金额 | 累计投注 | 如果盈利1% | 累计盈亏 |
|----------|----------|----------|------------|----------|
| 1 | 50 USDC | 50 | +0.5 | +0.5 |
| 2 (亏损) | 100 USDC | 150 | +1.0 | -49.0 |
| 3 (亏损) | 200 USDC | 350 | +2.0 | -148.0 |
| 4 (亏损) | 400 USDC | 750 | +4.0 | -346.0 |
| 5 (盈利) | 800 USDC | 1550 | +8.0 | +8.0 |

**关键点**：第5次盈利时，总盈利8 USDC > 前4次总亏损，实现整体盈利。

## ⚠️ 风险警告

### 高风险因素
1. **资金需求大**：连续亏损时需要大量资金
2. **最大亏损**：5次连续亏损可能损失 1550 USDC
3. **市场风险**：极端行情可能导致连续亏损
4. **交易所风险**：API故障、网络问题等

### 风险计算公式
```
最大可能亏损 = 基础金额 × (倍数^最大亏损次数 - 1) / (倍数 - 1)
示例：50 × (2^5 - 1) / (2 - 1) = 50 × 31 = 1550 USDC
```

## 🛡️ 安全建议

### 1. 资金管理
- 使用专用交易账户，不要投入全部资金
- 建议投入资金不超过总资产的10%
- 设置合理的基础金额和最大亏损次数

### 2. 监控要点
- 实时监控策略状态
- 关注连续亏损次数
- 定期检查市场条件

### 3. 应急措施
- 设置每日亏损限额
- 极端行情时手动停止策略
- 保持足够的资金储备

## 📈 策略优化

### 基础设置（保守）
```json
{
  "baseAmount": 30,
  "martingaleMultiplier": 2,
  "maxConsecutiveLosses": 4,
  "takeProfitPercentage": 0.8
}
```

### 进取设置（激进）
```json
{
  "baseAmount": 100,
  "martingaleMultiplier": 2.5,
  "maxConsecutiveLosses": 6,
  "takeProfitPercentage": 1.5
}
```

## 🔧 启动命令

### 基本启动
```bash
node martingale_trader.js
```

### 使用自定义配置
```bash
node martingale_trader.js custom_config.json
```

### 后台运行
```bash
nohup node martingale_trader.js > martingale.log 2>&1 &
```

### 停止策略
```bash
# 优雅停止 (Ctrl+C)
kill -SIGINT [PID]

# 强制停止
kill -SIGTERM [PID]
```

## 📊 实时监控

策略运行时会显示：
```
============================================================
📊 马丁格尔交易器状态
============================================================
🔄 运行状态: 运行中
💰 当前价格: 3234.56 USDC
💼 持仓数量: 0.029700 ETH
📈 持仓均价: 3230.00 USDC
📋 待处理订单: 0 笔

🎲 马丁格尔策略状态:
   策略状态: 运行中
   连续亏损: 2/5
   当前Level: 2
   下次金额: 200.00 USDC
   风险等级: 中风险 (40.0%)
   总交易数: 8 笔
============================================================
```

## 🔍 故障排除

### 常见问题

1. **API连接失败**
   ```
   原因：密钥错误或网络问题
   解决：检查配置文件中的API密钥
   ```

2. **订单提交失败**
   ```
   原因：余额不足或订单参数错误
   解决：检查USDC余额，调整订单金额
   ```

3. **价格获取失败**
   ```
   原因：WebSocket连接问题
   解决：重启策略，检查网络连接
   ```

### 日志文件
- 主日志：`logs/martingale_YYYYMMDD.log`
- 错误日志：`logs/martingale_error_YYYYMMDD.log`
- 交易日志：`logs/martingale_trades_YYYYMMDD.log`

## 🎯 最佳实践

1. **测试阶段**：先用小金额测试
2. **市场选择**：选择流动性好的交易对
3. **时间选择**：避免重大消息发布时使用
4. **止损执行**：严格执行止损，不要情绪化决策
5. **定期回顾**：分析交易记录，优化参数

## 📞 技术支持

如有问题，请查看：
1. 日志文件详细错误信息
2. 检查网络连接和API状态
3. 验证配置文件格式
4. 确认账户余额充足

**免责声明**：马丁格尔策略涉及高风险，可能导致重大损失。请在充分理解风险的情况下使用，投资有风险，决策需谨慎。