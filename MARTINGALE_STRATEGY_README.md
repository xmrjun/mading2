# 马丁格尔策略使用指南

## 🎯 策略概述

马丁格尔策略已成功实现并集成到交易系统中。该策略实现了：

- ✅ **双向交易** - 支持买入和卖出
- ✅ **递增投资** - 亏损后自动加倍投资金额
- ✅ **风险管理** - 连续亏损次数和总投资金额限制
- ✅ **自动止盈止损** - 智能平仓系统
- ✅ **趋势分析** - 基于价格历史的方向判断

## 🔧 配置说明

### 1. 启用马丁格尔策略
在 `backpack_trading_config.json` 中设置：
```json
{
  "trading": {
    "strategy": "martingale",
    "tradingCoin": "ETH"
  }
}
```

### 2. 马丁格尔策略参数
```json
{
  "martingale": {
    "baseAmount": 151,              // 基础投资金额(USD)
    "maxConsecutiveLosses": 5,      // 最大连续亏损次数
    "totalRiskLimit": 10000,        // 总风险限制(USD)
    "multiplier": 2,                // 递增倍数
    "stopLossPercentage": 2,        // 止损百分比
    "takeProfitPercentage": 1,      // 止盈百分比
    "priceHistoryLength": 10,       // 价格历史长度
    "trendAnalysisEnabled": true    // 启用趋势分析
  }
}
```

## 🚀 启动策略

```bash
# 启动马丁格尔策略
node start_single.js

# 或者使用双策略模式
node start_dual.js
```

## 📊 策略逻辑

### 交易序列
1. **初始交易**: 151 USD
2. **第一次亏损**: 302 USD (2倍)
3. **第二次亏损**: 604 USD (4倍)
4. **第三次亏损**: 1,208 USD (8倍)
5. **第四次亏损**: 2,416 USD (16倍)

### 风险控制
- 连续5次亏损后自动停止
- 总投资超过10,000 USD时停止
- 每笔交易都有止盈止损保护

## 🎲 实时监控

策略运行时会显示：
- 当前序列号
- 连续亏损次数
- 当前投资金额
- 交易方向
- 总投资和盈亏情况
- 剩余风险额度

## ⚠️ 风险提示

- 马丁格尔策略属于高风险策略
- 连续亏损可能导致巨额损失
- 请确保有足够的资金支持
- 建议先用小额资金测试

## 🔍 策略状态

系统会实时显示：
```
===== 🎲 马丁格尔策略状态 =====
当前序列: 3
连续亏损: 2
当前金额: 604 USDC
交易方向: buy
总投资: 1057.00 USDC
总盈亏: -57.00 USDC
剩余风险: 8943.00 USDC
是否停止: 否
==============================
```

## 🛠️ 技术实现

### 核心文件
- `src/core/martingaleStrategy.js` - 马丁格尔策略类
- `src/app.js` - 主应用逻辑
- `backpack_trading_config.json` - 配置文件

### 关键功能
- 趋势分析和方向判断
- 递增投资计算
- 实时止盈止损监控
- 风险管理和自动停止
- 交易历史记录

## 📝 使用建议

1. **测试模式**: 先用小额基础金额测试
2. **风险评估**: 根据资金量调整参数
3. **监控关注**: 密切关注策略状态
4. **及时调整**: 根据市场情况调整参数

---

**注意**: 使用前请确保理解马丁格尔策略的风险特征！